<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Reporting Form</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; background-color: #f4f4f9; color: #333; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        input:focus { border-color: #1DB446; outline: none; box-shadow: 0 0 5px rgba(29, 180, 70, 0.2); }
        button { width: 100%; padding: 15px; background-color: #1DB446; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        button:active { background-color: #169639; }
        .loading { display: none; text-align: center; color: #666; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="form-container">
        <h3>Submit New Expense</h3>
        
        <div class="form-group">
            <label>Bill No.</label>
            <input type="text" id="billNo" placeholder="Ex: SUYYMMNO">
        </div>

        <div class="form-group">
            <label>Item No.</label>
            <input type="text" id="itemNo" placeholder="Ex: 1">
        </div>

        <div class="form-group">
            <label>Description</label>
            <input type="text" id="desc" placeholder="Ex: à¹‚à¸„à¸£à¸‡à¹€à¸à¹‰à¸²à¸­à¸µà¹‰">
        </div>

        <div class="form-group">
            <label>Supplier</label>
            <input type="text" id="supplier" placeholder="Ex: à¸Šà¹ˆà¸²à¸‡A">
        </div>

        <div class="form-group">
            <label>Installment No.</label>
            <input type="Text" id="instNo" placeholder="Ex: 1/2">
        </div>

        <div class="form-group">
            <label>Amount</label>
            <input type="number" step="0.01" id="amount" placeholder="0.00">
        </div>

        <button id="submitBtn" onclick="sendData()">Submit Expense</button>
        <div id="loading" class="loading">Processing...</div>
    </div>

    <script>
        // 1. Initialize LIFF
        async function main() {
            try {
                await liff.init({ liffId: "2009003342-DR5kmBIl" }); // PASTE YOUR ID HERE
                if (!liff.isLoggedIn()) {
                    liff.login();
                }
            } catch (err) {
                console.error("LIFF Initialization failed", err);
            }
        }
        main();

        // 2. Send Data back to Chat
        async function sendData() {
            const bill = document.getElementById('billNo').value;
            const item = document.getElementById('itemNo').value;
            const desc = document.getElementById('desc').value;
            const supplier = document.getElementById('supplier').value;
            const inst = document.getElementById('instNo').value;
            const amount = document.getElementById('amount').value;

            // Simple Validation
            if (!bill || !amount) {
                alert("Please fill in at least the Bill No and Amount");
                return;
            }

            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('loading').style.display = 'block';

            // Generate a 3-character random Reference Code (e.g., A1B)
            const refCode = Math.random().toString(36).substring(2, 5).toUpperCase();

            const messageContent = `ðŸ“‹ *New Expense Submitted*\n\n` +
                                   `â€¢ Bill No: ${bill}\n` +
                                   `â€¢ Item No: ${item}\n` +
                                   `â€¢ Desc: ${desc}\n` +
                                   `â€¢ Supplier: ${supplier}\n` +
                                   `â€¢ Installment: ${inst}\n` +
                                   `â€¢ Amount: à¸¿${amount}\n`
                                   `â€¢ Ref: ${refCode}` +;
            

            try {
                // This sends the message as "the user" into the chat
                await liff.sendMessages([
                    {
                        type: 'text',
                        text: messageContent
                    }
                    {
                        type: 'text',
                        text: refCode
                    }
                ]);
                liff.closeWindow(); // Closes form after submission
            } catch (error) {
                alert("Error sending message: " + error.message);
                document.getElementById('submitBtn').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
            }
        }
    </script>
</body>
</html>
